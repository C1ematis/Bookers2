<div class= "container">
  <nav id= "error_explanation" >
    <% if @book != nil && @book.errors.any? %>
      <h3><%= @book.errors.count %> errors prohibited this obj from being saved:</h3>
      <ul>
        <% @book.errors.full_messages.each do |message| %>
          <li><%= message %></li>
      <% end %>
      </ul>
    <% end %>
  </nav>
  <div class= "row">
    <div class= "col-md-3" >
      <%= render 'users/info' , user: @user %>
      <%= render 'books/new' %>
    </div>

    <div class= "col-md-8 offset-md-1">
      <div class= "d-flex justify-content-between">
        <h2>Books</h2>
        <div class= "mt-2">
          <%= form_with url: books_path, method: :get, local: :true do |f| %>
            <%= f.search_field :word, :value => @word %>
            <%= f.select :search_kind, options_for_select([['タイトル'], ['タグ']], :selected => @search_kind) %>
            <%= f.submit "検索" %>
          <% end %>
        </div>
      </div>
      <% if @books != "no_search" %>
      <div>
        <% words = {word: @word} %>
        <%= sort_order "created_at", "日時" ,words %> | <%= sort_order "star", "評価", words %>
      </div>
      <table class= "table table-hover">
        <thead>
          <tr>
            <th colspan= "1"></th>
            <th>title</th>
            <th>option</th>
            <th colspan= "1"></th>
          </tr>
        </thead>
        <tbody>
          <% @books.each do |book| %>
            <tr>
              <td><%= link_to user_path(book.user.id) do %><%= attachment_image_tag book.user, :profile_image, size:"40x40", format: 'jpeg', fallback:"no_image.jpg" %><% end %></td>
              <td style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden; max-width: 0; width: 20%"><%= link_to book.title, book_path(book) %></td>
              <td style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden; max-width: 0; width: 50%"><%= book.body %></td>
              <td id= "favorite-btn<%= book.id %>" class= "text-nowrap">
                <%#= render 'favorites/favorite-btn', book: book %>
                </td>
            </tr>
            <script>
              $(document).on('turbolinks:load', function () {
                $('#favorite-btn<%= book.id %>').html("<%= j(render 'favorites/favorite-btn', book: book) %>");
              });
            </script>
          <% end %>
        </tbody>
      </table>
      <% else %><h5 class= "mt-5"><%= @search_kind %>"<%= @word %>"を含むBookはありません</h5><% end %>
    </div>
  </div>
</div>